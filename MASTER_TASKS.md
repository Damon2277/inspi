# Inspi.AI 项目主任务管理文档

> **📋 重要说明**: 本文件是项目任务定义的**单一真实来源**。所有任务执行都应以此文件为准。
> 
> **任务状态定义**:
> - `[ ]` **未开始** - 任务尚未开始执行
> - `[-]` **进行中** - 任务正在正常执行中  
> - `[!]` **存在问题** - 发现问题，需要立即修复（阻断状态）
> - `[~]` **部分完成** - 主要功能完成，但存在待优化项
> - `[?]` **待验证** - 功能完成，等待质量验证
> - `[R]` **需要返工** - 质量不达标，需要重新执行
> - `[P]` **暂停执行** - 因依赖或资源问题暂停
> - `[x]` **已完成** - 任务完全完成并通过验收

## 📊 项目概述

**产品**: Inspi.AI - AI驱动的教师智慧与IP孵化平台  
**当前状态**: 约60%核心功能完成，具备良好技术基础  
**目标**: 按PRD V1.0实现完整的教学创意生成和分享平台

### 已完成的基础工作 ✅
- [x] 项目基础设施搭建 (Next.js + TypeScript + Tailwind)
- [x] 数据库基础设施 (MongoDB + Redis)
- [x] 用户认证系统基础 (JWT + OAuth框架)
- [x] 移动端UI组件库 (完整的移动端组件)
- [x] 响应式设计基础 (断点系统 + 布局组件)
- [x] API路由结构 (完整的路由框架)
- [x] 数据模型设计 (User, Work, KnowledgeGraph等)
- [x] 基础测试框架 (Jest + Playwright)
- [x] 错误处理和日志系统
- [x] 性能优化基础 (缓存 + 懒加载)
- [x] PWA和移动端适配
- [x] 安全和隐私保护基础

## 🔥 第一阶段：MVP核心功能 (2-3周)

### Sprint 1: AI服务集成 (5天) - 当前优先级 P0

#### Task 1.1: Gemini API集成 (2天)
- [ ] **1.1.1 环境配置和API密钥设置** (0.5天)
  - 在Google AI Studio申请Gemini API密钥
  - 配置环境变量 `.env.local` 和 `.env.example`
  - 更新 `config/environment.ts` 添加AI配置
  - 验证API连接可用性
  - **负责人**: 后端开发
  - **验收标准**: API密钥正确配置，基础连接测试通过

- [ ] **1.1.2 创建AI服务封装类** (1天)
  - 创建 `src/lib/ai/geminiService.ts`
  - 实现基础的API调用封装
  - 添加错误处理和重试机制
  - 实现请求限流和缓存
  - **负责人**: 后端开发
  - **验收标准**: API调用封装完成，错误处理机制完善

- [ ] **1.1.3 设计提示词模板系统** (0.5天)
  - 创建 `src/lib/ai/promptTemplates.ts`
  - 设计四种卡片类型的提示词模板
  - 实现模板参数化和动态生成
  - 添加模板验证和测试
  - **负责人**: 后端开发 + 产品经理
  - **验收标准**: 四种卡片模板设计完成，生成内容符合预期

#### Task 1.2: 卡片生成API优化 (1天)
- [ ] **1.2.1 更新API路由实现** (0.5天)
  - 修改 `src/app/api/magic/generate/route.ts`
  - 集成真实的Gemini服务
  - 移除Mock数据逻辑
  - 添加请求验证和参数处理
  - **负责人**: 后端开发
  - **依赖**: Task 1.1.2

- [ ] **1.2.2 实现配额管理系统** (0.5天)
  - 更新User模型的配额检查方法
  - 实现配额重置定时任务
  - 添加配额监控和告警
  - 创建配额查询API
  - **负责人**: 后端开发
  - **验收标准**: 配额检查逻辑正确，不同用户等级限制生效

#### Task 1.3: 前端AI集成 (2天)
- [ ] **1.3.1 更新卡片生成组件** (1天)
  - 修改 `src/components/magic/CardGenerator.tsx`
  - 处理真实API响应格式
  - 优化加载状态和进度显示
  - 添加错误处理和重试机制
  - **负责人**: 前端开发
  - **依赖**: Task 1.2.1

- [ ] **1.3.2 优化用户体验** (1天)
  - 添加生成进度的详细状态
  - 实现卡片预览和编辑功能
  - 优化错误提示和用户引导
  - 添加生成历史记录显示
  - **负责人**: 前端开发
  - **验收标准**: 生成流程用户体验流畅，移动端适配良好

### Sprint 2: 用户认证完善 (3天) - 优先级 P0

#### Task 2.1: 邮件验证系统 (2天)
- [ ] **2.1.1 邮件服务集成** (0.5天)
  - 选择邮件服务提供商 (推荐Resend)
  - 配置邮件服务API密钥
  - 创建邮件服务封装类 `src/lib/email/service.ts`
  - 测试邮件发送功能
  - **负责人**: 后端开发
  - **验收标准**: 邮件服务配置正确，测试邮件发送成功

- [ ] **2.1.2 验证码生成和管理** (0.5天)
  - 创建验证码生成逻辑 `src/lib/email/verification.ts`
  - 实现验证码存储 (Redis)
  - 添加验证码过期机制
  - 实现验证码验证逻辑
  - **负责人**: 后端开发
  - **验收标准**: 验证码生成算法安全，Redis存储和过期正常

- [ ] **2.1.3 邮件模板设计** (0.5天)
  - 设计邮件HTML模板 `src/lib/email/templates.ts`
  - 创建多种邮件类型模板
  - 实现模板参数化
  - 测试邮件显示效果
  - **负责人**: 前端开发 + 设计师
  - **验收标准**: 邮件模板设计美观，多设备兼容性良好

- [ ] **2.1.4 API接口实现** (0.5天)
  - 创建发送验证码API `/api/auth/send-verification`
  - 创建验证邮箱API `/api/auth/verify-email`
  - 添加请求限流保护
  - 实现API文档
  - **负责人**: 后端开发
  - **验收标准**: API接口功能正确，请求限流保护有效

#### Task 2.2: 统一登录注册流程 (1天)
- [ ] **2.2.1 重构登录注册组件** (0.5天)
  - 重构 `LoginModal.tsx` 实现统一按钮
  - 添加邮件验证步骤
  - 优化用户体验流程
  - 实现状态管理
  - **负责人**: 前端开发
  - **依赖**: Task 2.1.4

- [ ] **2.2.2 优化认证流程UX** (0.5天)
  - 设计流程指示器
  - 添加动画过渡效果
  - 优化错误提示显示
  - 实现自动填充和记住功能
  - **负责人**: 前端开发 + UX设计师
  - **验收标准**: 流程指示清晰直观，动画效果流畅自然

### Sprint 3: 数据库优化 + 复用系统 (5天) - 优先级 P0

#### Task 3.1: MongoDB连接优化 (2天)
- [ ] **3.1.1 配置生产环境连接** (1天)
  - 配置MongoDB Atlas连接字符串
  - 实现连接池管理
  - 添加连接重试机制
  - 优化查询性能
  - **负责人**: 后端开发
  - **验收标准**: 数据库连接稳定，查询性能优化

- [ ] **3.1.2 数据初始化和测试** (1天)
  - 创建数据库初始化脚本
  - 实现测试数据生成工具
  - 添加数据清理工具
  - 实现数据一致性检查
  - **负责人**: 后端开发
  - **验收标准**: 初始化脚本正常运行，测试数据生成正常

#### Task 3.2: 致敬式复用系统 (3天)
- [ ] **3.2.1 复用权限设计** (0.5天)
  - 设计复用权限矩阵
  - 定义用户等级权限
  - 创建权限检查中间件
  - 实现权限验证逻辑
  - **负责人**: 产品经理 + 后端开发

- [ ] **3.2.2 复用API实现** (1.5天)
  - 实现作品复用API `/api/works/[id]/reuse`
  - 添加归属追踪逻辑
  - 实现复用链记录
  - 更新贡献度计算
  - **负责人**: 后端开发

- [ ] **3.2.3 复用前端界面** (1天)
  - 创建复用按钮组件 `ReuseButton.tsx`
  - 实现复用确认对话框
  - 添加归属信息显示
  - 实现复用历史查看
  - **负责人**: 前端开发

## 🟡 第二阶段：Beta版本功能 (3-4周)

### Sprint 4: 作品详情页 (3天) - 优先级 P1

#### Task 4.1: 作品详情系统
- [ ] **4.1.1 作品详情API** (1天)
  - 实现作品详情API `/api/works/[id]`
  - 添加相关作品推荐
  - 实现浏览统计
  - 优化查询性能
  - **负责人**: 后端开发

- [ ] **4.1.2 作品详情页面** (2天)
  - 创建作品详情页 `src/app/works/[id]/page.tsx`
  - 实现卡片展示组件
  - 添加作者信息和统计
  - 实现移动端适配
  - **负责人**: 前端开发

### Sprint 5: 知识图谱编辑器 (6天) - 优先级 P1

#### Task 5.1: 图谱编辑API (2天)
- [ ] **5.1.1 节点操作API** (1天)
  - 实现节点CRUD API
  - 添加节点关系管理
  - 实现节点验证逻辑
  - 优化批量操作
  - **负责人**: 后端开发

- [ ] **5.1.2 图谱版本控制** (1天)
  - 实现图谱版本管理
  - 添加变更历史记录
  - 实现回滚功能
  - 创建协作基础
  - **负责人**: 后端开发

#### Task 5.2: 可视化编辑器 (4天)
- [ ] **5.2.1 基础编辑功能** (2天)
  - 实现拖拽式节点编辑
  - 添加边的创建和编辑
  - 实现选择和多选功能
  - 添加右键菜单
  - **负责人**: 前端开发

- [ ] **5.2.2 高级编辑功能** (2天)
  - 实现撤销/重做功能
  - 添加图谱布局调整
  - 实现批量操作
  - 优化性能和体验
  - **负责人**: 前端开发

### Sprint 6: 贡献度可视化 (4天) - 优先级 P1

#### Task 6.1: 统计和徽章系统
- [ ] **6.1.1 统计数据API** (1天)
  - 实现用户统计数据API
  - 添加趋势数据计算
  - 实现排行榜优化
  - 创建统计缓存
  - **负责人**: 后端开发

- [ ] **6.1.2 徽章系统** (2天)
  - 设计徽章规则和图标
  - 实现徽章解锁逻辑
  - 创建徽章展示组件
  - 添加徽章通知
  - **负责人**: 后端开发 + 设计师 + 前端开发

- [ ] **6.1.3 统计仪表板** (1天)
  - 实现个人统计页面
  - 添加图表可视化
  - 创建趋势分析
  - 优化数据展示
  - **负责人**: 前端开发

## 🟢 第三阶段：优化和完善 (2-3周)

### Sprint 7: 高级搜索功能 (3天) - 优先级 P2

#### Task 7.1: 搜索系统优化
- [ ] **7.1.1 全文搜索实现** (2天)
  - 实现MongoDB全文搜索索引
  - 添加智能搜索建议
  - 优化搜索算法和性能
  - 实现搜索结果缓存
  - **负责人**: 后端开发

- [ ] **7.1.2 高级筛选界面** (1天)
  - 实现多维度筛选组件
  - 添加标签系统
  - 创建筛选历史
  - 优化筛选体验
  - **负责人**: 前端开发

### Sprint 8: 性能优化 (4天) - 优先级 P2

#### Task 8.1: 前端性能优化 (2天)
- [ ] **8.1.1 代码和资源优化** (2天)
  - 实现代码分割和懒加载
  - 优化Bundle大小和图片资源
  - 添加预加载策略和CDN配置
  - 优化渲染性能和PWA功能
  - **负责人**: 前端开发

#### Task 8.2: 后端性能优化 (2天)
- [ ] **8.2.1 数据库和API优化** (2天)
  - 优化数据库查询和索引策略
  - 实现Redis缓存策略和API限流
  - 优化响应时间和批量操作
  - 实现连接池优化
  - **负责人**: 后端开发

### Sprint 9: 监控和运维 (3天) - 优先级 P2

#### Task 9.1: 监控系统 (3天)
- [ ] **9.1.1 错误监控和分析** (2天)
  - 集成Sentry错误监控
  - 实现性能监控和用户行为分析
  - 添加系统健康检查和服务状态监控
  - 配置告警系统和自动恢复
  - **负责人**: 后端开发

- [ ] **9.1.2 日志和备份系统** (1天)
  - 实现结构化日志和日志聚合
  - 配置日志分析和数据备份
  - 实现监控仪表板
  - **负责人**: 后端开发

## 🖥️ PC端UI增强 (并行开发)

### PC Sprint A: 桌面端专属功能 (1-2周) - 优先级 P2

#### Task PC-A.1: 多窗口和快捷键系统 (5天)
- [ ] **PC-A.1.1 标签页系统** (2天)
  - 创建 `src/components/desktop/TabSystem.tsx`
  - 实现标签页状态管理和拖拽排序
  - 添加标签页关闭确认机制
  - **负责人**: 前端开发

- [ ] **PC-A.1.2 键盘快捷键系统** (2天)
  - 扩展全局快捷键和自定义功能
  - 实现上下文相关快捷键
  - 添加快捷键帮助面板
  - **负责人**: 前端开发

- [ ] **PC-A.1.3 右键菜单系统** (1天)
  - 创建 `src/components/desktop/ContextMenu.tsx`
  - 实现通用和特定内容右键菜单
  - 添加菜单位置智能调整
  - **负责人**: 前端开发

### PC Sprint B: 视觉和交互增强 (1周) - 优先级 P3

#### Task PC-B.1: 主题和动画系统 (5天)
- [ ] **PC-B.1.1 深色模式和主题** (3天)
  - 实现完整深色模式
  - 添加自定义主题支持
  - 实现主题切换动画
  - **负责人**: 前端开发 + 设计师

- [ ] **PC-B.1.2 高级动画效果** (2天)
  - 增强页面过渡和交互反馈动画
  - 实现高分辨率和多显示器支持
  - 优化动画性能
  - **负责人**: 前端开发

### PC Sprint C: 性能和体验优化 (1周) - 优先级 P3

#### Task PC-C.1: 桌面端优化 (5天)
- [ ] **PC-C.1.1 性能优化** (3天)
  - 实现虚拟滚动和大数据量渲染优化
  - 优化内存使用和资源清理
  - 添加渲染性能监控
  - **负责人**: 前端开发

- [ ] **PC-C.1.2 缓存和分析** (2天)
  - 实现智能缓存策略和离线功能增强
  - 集成桌面端用户行为分析
  - 实现A/B测试框架
  - **负责人**: 前端开发

## 🎯 关键里程碑

### Milestone 1: MVP完成 (第3周末)
**验收标准**:
- [ ] AI卡片生成功能正常工作 (真实Gemini API)
- [ ] 用户注册登录流程完整 (邮件验证)
- [ ] 致敬式复用功能基本可用
- [ ] 数据库连接稳定可靠

### Milestone 2: Beta版本 (第7周末)
**验收标准**:
- [ ] 知识图谱编辑器基本可用
- [ ] 作品详情页完整
- [ ] 贡献度可视化系统运行
- [ ] 移动端体验优化完成

### Milestone 3: 正式版本 (第10周末)
**验收标准**:
- [ ] 所有核心功能完善
- [ ] 性能达到PRD要求 (页面<2s, API<500ms, AI<5s)
- [ ] 监控和运维系统就绪
- [ ] PC端体验优化完成

## ⚠️ 风险管控

### 🚨 高风险任务
1. **Gemini API集成** (Task 1.1) - API限制、性能、内容质量
2. **知识图谱编辑器** (Task 5.2) - 复杂前端交互、性能问题
3. **数据库性能** (Task 3.1) - 大量图谱数据查询性能

### 缓解策略
1. **API备选方案** - 准备OpenAI GPT作为Gemini备选
2. **渐进实现** - 复杂功能分阶段实现，先基础后高级
3. **性能测试** - 及早进行性能和压力测试
4. **数据优化** - 优化数据库索引，实现查询缓存

## 📊 成功指标

### 技术指标
- 页面加载时间 < 2秒
- API响应时间 < 500ms
- AI生成响应时间 < 5秒
- 系统可用性 > 99.9%

### 业务指标
- 用户注册转化率 > 60%
- AI生成成功率 > 95%
- 作品复用率 > 20%
- 用户留存率 > 40%

## 👥 团队分工

### 后端开发 (2人)
- **主要职责**: AI服务集成、API开发、数据库优化
- **当前重点**: Task 1.1-1.2 (AI集成), Task 2.1 (邮件系统)

### 前端开发 (2人)
- **主要职责**: UI组件开发、用户体验优化、移动端适配
- **当前重点**: Task 1.3 (AI前端集成), Task 2.2 (认证UX)

### 全栈开发 (1人)
- **主要职责**: 系统集成、部署运维、技术支持
- **当前重点**: Task 3.1 (数据库优化), 部署环境配置

### 产品经理 (1人)
- **主要职责**: 需求管理、测试协调、进度跟踪
- **当前重点**: Task 1.1.3 (提示词设计), Task 3.2.1 (复用权限设计)

---

**最后更新**: 2024年1月  
**文档版本**: v2.0  
**负责人**: 项目团队