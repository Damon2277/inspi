# 教学卡片体验升级方案

## 1. 产品定位
- **目标用户**：一线教师、教研员，需要高效从知识点生成课堂可执行卡片。
- **核心诉求**：
  - 卡片内容结构化、易于课堂展示；
  - SOP（标准作业流程）指引明确；
  - 支持课堂演示、导出分享等串联动作。

## 2. 功能分层
| 层级 | 功能点 | 说明 |
|------|--------|------|
| 数据层 | SOP schema 扩展 | 在生成结果中新增 `sopSteps`（目标、时间、师生活动、达成证据等字段），支持多语言与多媒体扩展。 |
| 体验层 | 卡片查看器 | `GeneratedCard` 新增“卡片视图 / SOP 视图 / 演示视图”三种模式，默认展示结构化摘要，可切换到操作化细项。 |
| 控制层 | 演示模式 | 新增 `PresentationController` 组件，提供左右切换、聚光灯高亮、计时器、分组提示等能力；与投屏保持 16:9 自适应。 |
| 流程层 | 导出与分享 | 同步支持导出为 PDF / PNG、复制演示链接，后端记录导出日志并触发教师工作台通知。 |

## 3. 交互流程
1. 教师完成登录并生成卡片。
2. 在结果区以“卡片列表”展示，每张卡片含信息概览、SOP 折叠面板、演示预览入口。
3. 点击“演示模式”进入全屏：顶部展示课程信息、右下角显示计时器，底部提供快捷键提示。
4. 导出入口支持一次性选择多张卡片生成合辑文件，并可分享链接给协同教师。

## 4. 技术实现要点
- **数据接口**：`/api/magic/generate` 响应体新增 `sopSteps` 数组：
  ```json
  {
    "title": "导入：激发兴趣",
    "duration": 3,
    "steps": [
      {
        "goal": "引出核心问题",
        "teacher": "播放生活化情境视频，提出问题",
        "students": "快速讨论并举手分享",
        "evidence": "至少 3 名学生能说出困惑点",
        "differentiation": "提供提示卡给基础薄弱组"
      }
    ]
  }
  ```
- **组件设计**：
  - `GeneratedCard`: 接收 `sopSteps` 与 `presentationMeta`，通过 `Tabs` 或 `SegmentedControl` 实现视图切换。
  - `PresentationDeck`: 负责全屏播放，使用 `framer-motion` 实现入场动画与焦点高亮。
  - `ExportSharePanel`: 扩展导出选项、引导配置（分辨率、主题）。
- **状态管理**：使用 `zustand` 管理当前演示状态（卡片索引、计时状态、托管投屏设备）。
- **无障碍**：演示模式需支持键盘导航和屏幕阅读器描述。

## 5. 验收指标
- 生成卡片后，教师能在 3 点击内进入演示模式。
- SOP 视图中每个步骤都包含达成证据与差异化支持字段。
- 导出的 PDF 与现场演示布局一致，排版错误率低于 2%。
- 演示模式整课运行 45 分钟内无性能抖动（FPS ≥ 55）。

## 6. 发布节奏建议
| Sprint | 目标 | 交付物 |
|--------|------|--------|
| S1 | 数据与组件基建 | SOP schema、生成接口 mock、卡片视图切换基础能力 |
| S2 | 演示模式 MVP | PresentationDeck、快捷键、投屏优化 |
| S3 | 导出与分享 | 导出 PDF/PNG、分享链接、日志记录 |
| S4 | 课堂实测与优化 | 教师内测反馈、性能调优、体验 polish |

## 7. 风险与缓解
- **数据冗长**：SOP 文案过多导致界面拥挤 → 采用步骤折叠与重点高亮，允许教师自定义精简。
- **跨端兼容**：投屏设备分辨率差异 → 通过响应式布局与缩放控制，提供预览调节。
- **AI 生成稳定性**：结果质量波动 → 提供人工编辑入口并记录课程模板，支持快速复用。

此路线图可与 `docs/quality-improvement-plan.md` 联动，确保质量治理与体验创新并行落地。
